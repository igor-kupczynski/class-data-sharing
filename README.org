#+TITLE: README

* Tasks
** Baseline
*** [X] Establish time to load
**** Unscientific baseline

- Time to serve the request
- Via a shell script =make time=
- On local laptop
  
  #+BEGIN_SRC sh
$ make time
2274be994b13eb141ad160b7d7229252adb6f6b9acad0657008f7b1dea6696f4
Timing the wait on elastic
......        6.47 real         0.05 user         0.06 sys
foo
$ make time
879eadf4fbea38e0404a2959591369789ae61b4c67acbd440aced14670795f2b
Timing the wait on elastic
.......        7.42 real         0.06 user         0.07 sys
foo
$ make time
2c9d1120652874111aa1a524a70610a099240de8ded1b1d62d2c03f2484d81f9
Timing the wait on elastic
.......        7.42 real         0.06 user         0.07 sys
foo
  #+END_SRC

**** Time to load the class

#+BEGIN_SRC sh
$ docker run --rm -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" --env ES_JAVA_OPTS="-Xlog:class+load:file=clstrace.log" -it "igor-kupczynski/elasticsearch-oss:6.2.4-jdk10"


# then in a different tab

$ docker exec -it infallible_mirzakhani bash
# grep org.elasticsearch.bootstrap.Elasticsearch clstrace.log*
clstrace.log:[0.381s][info][class,load] org.elasticsearch.bootstrap.Elasticsearch source: file:/usr/share/elasticsearch/lib/elasticsearch-6.2.4.jar
#+END_SRC

*** [ ] Establish memory usage

** Class data sharing
*** Dump

#+BEGIN_SRC sh
export ES_JAVA_OPTS="-Xshare:dump -XX:+UseAppCDS \
    -XX:SharedClassListFile=/app/cache/elasticsearch_appcds.cls \
    -XX:+UnlockDiagnosticVMOptions \
    -XX:SharedArchiveFile=/app/cache/elasticsearch_appcds.jsa"
docker run --rm -p 9200:9200 -p 9300:9300 -e "discovery.type=single-node" --env ES_JAVA_OPTS -it "igor-kupczynski/elasticsearch-oss:6.2.4-jdk10"
#+END_SRC

